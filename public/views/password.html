<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>SendIT | Password recovery</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" media="screen" href="../css/font-awesome.min.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="../css/scarfold.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="../css/styles.css" />
</head>

<body>
	<header class="header align-bottom">
		<div class="header-content">
			<a href="" class="brand-name">SendIT<sup class="size-12">&trade;</sup></a>
			<div class="menu-div">
				<ul class="navbar">
					<li><a href="/" class="btn btn-link btn-sm">Home</a></li>
					<li><a href="/signin" class="btn btn-link btn-sm">Sign in</a></li>
				</ul>
			</div>
		</div>
	</header>
	<div class="row no-gutters">
		<div class="col-lg-6 offset-lg-3 col-md-10 offset-md-1 col-sm-12 offset-sm-0">
			<div class="auth-container">
				<div class="row no-gutters">
					<div class="col-12">
						<div class="wrapper auth-padding">
							<div class="row">
								<div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 col-sm-12 offset-sm-0">
									<div class="align-center bold mt-lg">
										<h2>Password Recovery</h2>
									</div>
									<form class="form" action="" method="POST">
										<div class="section">
											<div class="control-group">
												<label for="email">E-mail address</label>
												<input type="email" class="control col-12" name="email" id="email" placeholder="E-mail address"
												 autocomplete="off" autofocus>
											</div>
											<div id="message"></div>
											<div class="control-group mb-sm">
												<button class="btn btn-primary btn-block btn-lg" id="submit" onclick="verifiyEmail(event)">Continue</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<footer class="footer">
				<div class="footer-content align-center">
					&copy; Andela bootcamp,
					<script>document.write(new Date().getFullYear())</script>. All right reserved
				</div>
			</footer>
		</div>
	</div>
</body>
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/script.js"></script>
<script>
	const verifiyEmail = async (e) => {
		e.preventDefault();
		const email = document.getElementById('email');
		const fields = [email.id];
		if (!hasEmpty(fields) && isEmail(email)) {
			processing({ start: true, message: 'Please wait...' })
			await fetch(request({
				path: `/auth/email`, fields
			})).then(res => res.json())
			.then((res) => {
				if (res.status === 'Success') {
					resetPassword(email);
				} else {
					displayError(email, res.message);
				}
			})
			.catch(error => message(error.message, error.status));
			processing({ start: false, message: 'Continue' });
		}
	}

	const generatePassword = () => {
		const str = 'abcdefghijklmnopqrstuvwxyz';
		const mix = str.concat(str.toUpperCase());
		let password = '';
		do {
			password = password.concat(mix[Math.floor( Math.random() * 51)]);
		} while (password.length < 12);
		console.log(password)
		return password;
	}
	const resetPassword = async (email) => {
		fetch(request({
			path: `/auth/resetPassword`,
			method: 'PUT',
			data: getFormData([email.id], (data) => {
				data.password = generatePassword();
				return data;
			})
		})).then(res => res.json())
		.then((res) => {
			message(`A new password was sent to <b>${email.value}</b> <br/> Kindly check your inbox or spam`, res.status);
			email.value = '';
		})
		.catch((error) => message(error.message, error.status))
	}
</script>

</html>