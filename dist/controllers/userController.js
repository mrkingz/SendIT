'use strict';

var cov_20rryxkpmw = function () {
  var path = 'C:\\Users\\Kingsley\\Desktop\\SendIT\\server\\controllers\\userController.js',
      hash = 'de290f8c1f1698e8688e4a569ec0ce61c71dc044',
      Function = function () {}.constructor,
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: 'C:\\Users\\Kingsley\\Desktop\\SendIT\\server\\controllers\\userController.js',
    statementMap: {
      '0': {
        start: {
          line: 8,
          column: 0
        },
        end: {
          line: 8,
          column: 14
        }
      },
      '1': {
        start: {
          line: 23,
          column: 2
        },
        end: {
          line: 34,
          column: 4
        }
      },
      '2': {
        start: {
          line: 24,
          column: 20
        },
        end: {
          line: 24,
          column: 42
        }
      },
      '3': {
        start: {
          line: 25,
          column: 3
        },
        end: {
          line: 25,
          column: 68
        }
      },
      '4': {
        start: {
          line: 26,
          column: 3
        },
        end: {
          line: 26,
          column: 53
        }
      },
      '5': {
        start: {
          line: 27,
          column: 3
        },
        end: {
          line: 27,
          column: 90
        }
      },
      '6': {
        start: {
          line: 29,
          column: 3
        },
        end: {
          line: 29,
          column: 34
        }
      },
      '7': {
        start: {
          line: 31,
          column: 33
        },
        end: {
          line: 31,
          column: 41
        }
      },
      '8': {
        start: {
          line: 32,
          column: 3
        },
        end: {
          line: 32,
          column: 31
        }
      },
      '9': {
        start: {
          line: 33,
          column: 3
        },
        end: {
          line: 33,
          column: 80
        }
      },
      '10': {
        start: {
          line: 46,
          column: 4
        },
        end: {
          line: 70,
          column: 6
        }
      },
      '11': {
        start: {
          line: 47,
          column: 34
        },
        end: {
          line: 47,
          column: 42
        }
      },
      '12': {
        start: {
          line: 48,
          column: 20
        },
        end: {
          line: 48,
          column: 49
        }
      },
      '13': {
        start: {
          line: 50,
          column: 6
        },
        end: {
          line: 68,
          column: 7
        }
      },
      '14': {
        start: {
          line: 51,
          column: 8
        },
        end: {
          line: 51,
          column: 62
        }
      },
      '15': {
        start: {
          line: 53,
          column: 23
        },
        end: {
          line: 53,
          column: 50
        }
      },
      '16': {
        start: {
          line: 54,
          column: 8
        },
        end: {
          line: 67,
          column: 9
        }
      },
      '17': {
        start: {
          line: 55,
          column: 10
        },
        end: {
          line: 66,
          column: 11
        }
      },
      '18': {
        start: {
          line: 56,
          column: 12
        },
        end: {
          line: 64,
          column: 13
        }
      },
      '19': {
        start: {
          line: 57,
          column: 14
        },
        end: {
          line: 57,
          column: 54
        }
      },
      '20': {
        start: {
          line: 59,
          column: 42
        },
        end: {
          line: 59,
          column: 67
        }
      },
      '21': {
        start: {
          line: 60,
          column: 14
        },
        end: {
          line: 63,
          column: 16
        }
      },
      '22': {
        start: {
          line: 65,
          column: 12
        },
        end: {
          line: 65,
          column: 18
        }
      },
      '23': {
        start: {
          line: 69,
          column: 6
        },
        end: {
          line: 69,
          column: 51
        }
      },
      '24': {
        start: {
          line: 81,
          column: 4
        },
        end: {
          line: 87,
          column: 11
        }
      },
      '25': {
        start: {
          line: 97,
          column: 4
        },
        end: {
          line: 130,
          column: 6
        }
      },
      '26': {
        start: {
          line: 98,
          column: 20
        },
        end: {
          line: 98,
          column: 55
        }
      },
      '27': {
        start: {
          line: 99,
          column: 18
        },
        end: {
          line: 100,
          column: 43
        }
      },
      '28': {
        start: {
          line: 101,
          column: 6
        },
        end: {
          line: 128,
          column: 7
        }
      },
      '29': {
        start: {
          line: 102,
          column: 22
        },
        end: {
          line: 102,
          column: 52
        }
      },
      '30': {
        start: {
          line: 103,
          column: 22
        },
        end: {
          line: 103,
          column: 39
        }
      },
      '31': {
        start: {
          line: 105,
          column: 8
        },
        end: {
          line: 105,
          column: 43
        }
      },
      '32': {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 127,
          column: 9
        }
      },
      '33': {
        start: {
          line: 108,
          column: 10
        },
        end: {
          line: 110,
          column: 13
        }
      },
      '34': {
        start: {
          line: 111,
          column: 10
        },
        end: {
          line: 120,
          column: 11
        }
      },
      '35': {
        start: {
          line: 112,
          column: 27
        },
        end: {
          line: 112,
          column: 54
        }
      },
      '36': {
        start: {
          line: 113,
          column: 12
        },
        end: {
          line: 118,
          column: 13
        }
      },
      '37': {
        start: {
          line: 114,
          column: 14
        },
        end: {
          line: 117,
          column: 15
        }
      },
      '38': {
        start: {
          line: 115,
          column: 16
        },
        end: {
          line: 115,
          column: 43
        }
      },
      '39': {
        start: {
          line: 116,
          column: 16
        },
        end: {
          line: 116,
          column: 30
        }
      },
      '40': {
        start: {
          line: 119,
          column: 12
        },
        end: {
          line: 119,
          column: 51
        }
      },
      '41': {
        start: {
          line: 122,
          column: 10
        },
        end: {
          line: 126,
          column: 11
        }
      },
      '42': {
        start: {
          line: 123,
          column: 12
        },
        end: {
          line: 123,
          column: 57
        }
      },
      '43': {
        start: {
          line: 125,
          column: 12
        },
        end: {
          line: 125,
          column: 68
        }
      },
      '44': {
        start: {
          line: 129,
          column: 6
        },
        end: {
          line: 129,
          column: 51
        }
      },
      '45': {
        start: {
          line: 140,
          column: 4
        },
        end: {
          line: 144,
          column: 6
        }
      },
      '46': {
        start: {
          line: 141,
          column: 6
        },
        end: {
          line: 143,
          column: 91
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 22,
            column: 1
          },
          end: {
            line: 22,
            column: 2
          }
        },
        loc: {
          start: {
            line: 22,
            column: 19
          },
          end: {
            line: 35,
            column: 2
          }
        },
        line: 22
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 23,
            column: 9
          },
          end: {
            line: 23,
            column: 10
          }
        },
        loc: {
          start: {
            line: 23,
            column: 23
          },
          end: {
            line: 34,
            column: 3
          }
        },
        line: 23
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 45,
            column: 2
          },
          end: {
            line: 45,
            column: 3
          }
        },
        loc: {
          start: {
            line: 45,
            column: 18
          },
          end: {
            line: 71,
            column: 3
          }
        },
        line: 45
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 46,
            column: 11
          },
          end: {
            line: 46,
            column: 12
          }
        },
        loc: {
          start: {
            line: 46,
            column: 25
          },
          end: {
            line: 70,
            column: 5
          }
        },
        line: 46
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 80,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        },
        loc: {
          start: {
            line: 80,
            column: 36
          },
          end: {
            line: 88,
            column: 3
          }
        },
        line: 80
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 96,
            column: 2
          },
          end: {
            line: 96,
            column: 3
          }
        },
        loc: {
          start: {
            line: 96,
            column: 28
          },
          end: {
            line: 131,
            column: 3
          }
        },
        line: 96
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 97,
            column: 11
          },
          end: {
            line: 97,
            column: 12
          }
        },
        loc: {
          start: {
            line: 97,
            column: 31
          },
          end: {
            line: 130,
            column: 5
          }
        },
        line: 97
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 139,
            column: 2
          },
          end: {
            line: 139,
            column: 3
          }
        },
        loc: {
          start: {
            line: 139,
            column: 25
          },
          end: {
            line: 145,
            column: 3
          }
        },
        line: 139
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 140,
            column: 11
          },
          end: {
            line: 140,
            column: 12
          }
        },
        loc: {
          start: {
            line: 140,
            column: 31
          },
          end: {
            line: 144,
            column: 5
          }
        },
        line: 140
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 27,
            column: 22
          },
          end: {
            line: 27,
            column: 89
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 27,
            column: 56
          },
          end: {
            line: 27,
            column: 61
          }
        }, {
          start: {
            line: 27,
            column: 64
          },
          end: {
            line: 27,
            column: 89
          }
        }],
        line: 27
      },
      '1': {
        loc: {
          start: {
            line: 50,
            column: 6
          },
          end: {
            line: 68,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 50,
            column: 6
          },
          end: {
            line: 68,
            column: 7
          }
        }, {
          start: {
            line: 50,
            column: 6
          },
          end: {
            line: 68,
            column: 7
          }
        }],
        line: 50
      },
      '2': {
        loc: {
          start: {
            line: 50,
            column: 10
          },
          end: {
            line: 50,
            column: 59
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 50,
            column: 11
          },
          end: {
            line: 50,
            column: 31
          }
        }, {
          start: {
            line: 50,
            column: 36
          },
          end: {
            line: 50,
            column: 59
          }
        }],
        line: 50
      },
      '3': {
        loc: {
          start: {
            line: 55,
            column: 10
          },
          end: {
            line: 66,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 55,
            column: 10
          },
          end: {
            line: 66,
            column: 11
          }
        }, {
          start: {
            line: 55,
            column: 10
          },
          end: {
            line: 66,
            column: 11
          }
        }],
        line: 55
      },
      '4': {
        loc: {
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 64,
            column: 13
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 64,
            column: 13
          }
        }, {
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 64,
            column: 13
          }
        }],
        line: 56
      },
      '5': {
        loc: {
          start: {
            line: 99,
            column: 18
          },
          end: {
            line: 100,
            column: 43
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 99,
            column: 18
          },
          end: {
            line: 99,
            column: 35
          }
        }, {
          start: {
            line: 99,
            column: 39
          },
          end: {
            line: 99,
            column: 59
          }
        }, {
          start: {
            line: 99,
            column: 63
          },
          end: {
            line: 99,
            column: 78
          }
        }, {
          start: {
            line: 100,
            column: 8
          },
          end: {
            line: 100,
            column: 22
          }
        }, {
          start: {
            line: 100,
            column: 26
          },
          end: {
            line: 100,
            column: 43
          }
        }],
        line: 99
      },
      '6': {
        loc: {
          start: {
            line: 101,
            column: 6
          },
          end: {
            line: 128,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 101,
            column: 6
          },
          end: {
            line: 128,
            column: 7
          }
        }, {
          start: {
            line: 101,
            column: 6
          },
          end: {
            line: 128,
            column: 7
          }
        }],
        line: 101
      },
      '7': {
        loc: {
          start: {
            line: 105,
            column: 16
          },
          end: {
            line: 105,
            column: 42
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 105,
            column: 26
          },
          end: {
            line: 105,
            column: 34
          }
        }, {
          start: {
            line: 105,
            column: 37
          },
          end: {
            line: 105,
            column: 42
          }
        }],
        line: 105
      },
      '8': {
        loc: {
          start: {
            line: 111,
            column: 10
          },
          end: {
            line: 120,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 111,
            column: 10
          },
          end: {
            line: 120,
            column: 11
          }
        }, {
          start: {
            line: 111,
            column: 10
          },
          end: {
            line: 120,
            column: 11
          }
        }],
        line: 111
      },
      '9': {
        loc: {
          start: {
            line: 114,
            column: 14
          },
          end: {
            line: 117,
            column: 15
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 114,
            column: 14
          },
          end: {
            line: 117,
            column: 15
          }
        }, {
          start: {
            line: 114,
            column: 14
          },
          end: {
            line: 117,
            column: 15
          }
        }],
        line: 114
      },
      '10': {
        loc: {
          start: {
            line: 122,
            column: 10
          },
          end: {
            line: 126,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 122,
            column: 10
          },
          end: {
            line: 126,
            column: 11
          }
        }, {
          start: {
            line: 122,
            column: 10
          },
          end: {
            line: 126,
            column: 11
          }
        }],
        line: 122
      },
      '11': {
        loc: {
          start: {
            line: 141,
            column: 13
          },
          end: {
            line: 143,
            column: 90
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 142,
            column: 10
          },
          end: {
            line: 142,
            column: 16
          }
        }, {
          start: {
            line: 143,
            column: 10
          },
          end: {
            line: 143,
            column: 90
          }
        }],
        line: 141
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0, 0, 0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0],
      '11': [0, 0]
    },
    _coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _dotenv = require('dotenv');

var _dotenv2 = _interopRequireDefault(_dotenv);

var _bcrypt = require('bcrypt');

var _bcrypt2 = _interopRequireDefault(_bcrypt);

var _jsonwebtoken = require('jsonwebtoken');

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

var _collections = require('../collections');

var _collections2 = _interopRequireDefault(_collections);

var _UtilityService2 = require('../helpers/UtilityService');

var _UtilityService3 = _interopRequireDefault(_UtilityService2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

cov_20rryxkpmw.s[0]++;


_dotenv2.default.load();

/**
 * @export
 * @class UserController
 * @extends { UtilityService }
 */

var UserController = function (_UtilityService) {
  _inherits(UserController, _UtilityService);

  function UserController() {
    _classCallCheck(this, UserController);

    return _possibleConstructorReturn(this, (UserController.__proto__ || Object.getPrototypeOf(UserController)).apply(this, arguments));
  }

  _createClass(UserController, null, [{
    key: 'register',

    /**
     * 
     * @static
     * @returns {function} aA middleware function that handles the POST request
     * @memberof UserController
     */
    value: function register() {
      var _this2 = this;

      cov_20rryxkpmw.f[0]++;
      cov_20rryxkpmw.s[1]++;

      return function (req, res) {
        cov_20rryxkpmw.f[1]++;

        var hashSalt = (cov_20rryxkpmw.s[2]++, _bcrypt2.default.genSaltSync(10));
        cov_20rryxkpmw.s[3]++;
        req.body.password = _bcrypt2.default.hashSync(req.body.password, hashSalt);
        cov_20rryxkpmw.s[4]++;
        req.body.userId = _collections2.default.getUsersCount() + 1;
        cov_20rryxkpmw.s[5]++;
        req.body.isAdmin = _lodash2.default.isUndefined(req.body.isAdmin) ? (cov_20rryxkpmw.b[0][0]++, false) : (cov_20rryxkpmw.b[0][1]++, Boolean(req.body.isAdmin));

        cov_20rryxkpmw.s[6]++;
        _collections2.default.addUsers(req.body);

        var _ref = (cov_20rryxkpmw.s[7]++, req.body),
            password = _ref.password,
            data = _objectWithoutProperties(_ref, ['password']);

        cov_20rryxkpmw.s[8]++;

        data.createdAt = new Date();
        cov_20rryxkpmw.s[9]++;
        return _this2.successResponse(res, 201, 'Registration was successfull', data);
      };
    }

    /**
     * Sign in a user with email and password
     * 
     * @static 
     * @returns {function} Returns an express middleware function that handles the POST 
     * request to signup a user
     * @memberof UserController
     */

  }, {
    key: 'signin',
    value: function signin() {
      var _this3 = this;

      cov_20rryxkpmw.f[2]++;
      cov_20rryxkpmw.s[10]++;

      return function (req, res) {
        cov_20rryxkpmw.f[3]++;

        var _ref2 = (cov_20rryxkpmw.s[11]++, req.body),
            email = _ref2.email,
            password = _ref2.password;

        var message = (cov_20rryxkpmw.s[12]++, 'Invalid sign in credentials');

        cov_20rryxkpmw.s[13]++;
        if ((cov_20rryxkpmw.b[2][0]++, _lodash2.default.isUndefined(email)) || (cov_20rryxkpmw.b[2][1]++, _lodash2.default.isUndefined(password))) {
          cov_20rryxkpmw.b[1][0]++;
          cov_20rryxkpmw.s[14]++;

          message = 'E-mail address and password are required!';
        } else {
          cov_20rryxkpmw.b[1][1]++;

          var length = (cov_20rryxkpmw.s[15]++, _collections2.default.getUsersCount());
          cov_20rryxkpmw.s[16]++;
          for (var i = 0; i < length; i++) {
            cov_20rryxkpmw.s[17]++;

            if (_collections2.default.getUsers()[i].email === email) {
              cov_20rryxkpmw.b[3][0]++;
              cov_20rryxkpmw.s[18]++;

              if (!_bcrypt2.default.compareSync(password, _collections2.default.getUsers()[i].password)) {
                cov_20rryxkpmw.b[4][0]++;
                cov_20rryxkpmw.s[19]++;

                message = 'Invalid sign in credentials';
              } else {
                cov_20rryxkpmw.b[4][1]++;

                var _ref3 = (cov_20rryxkpmw.s[20]++, _collections2.default.getUsers()[i]),
                    userId = _ref3.userId,
                    isAdmin = _ref3.isAdmin;

                cov_20rryxkpmw.s[21]++;

                return _this3.successResponse(res, 200, 'Successfully signed in', {
                  token: _this3.generateToken({ userId: userId, isAdmin: isAdmin, email: email })
                });
              }
              cov_20rryxkpmw.s[22]++;
              break;
            } else {
              cov_20rryxkpmw.b[3][1]++;
            }
          }
        }
        cov_20rryxkpmw.s[23]++;
        return _this3.errorResponse(res, 401, message);
      };
    }

    /**
     * Generate a JWT for authenticated user
     *
     * @param {object} credentials
     * @returns {string} the generated token
     * @memberof UserController
     */

  }, {
    key: 'generateToken',
    value: function generateToken(credentials) {
      cov_20rryxkpmw.f[4]++;
      cov_20rryxkpmw.s[24]++;

      return _jsonwebtoken2.default.sign(_extends({}, credentials), process.env.SECRET_KEY, {
        issuer: process.env.ISSUER,
        subject: process.env.SUBJECT,
        expiresIn: process.env.EXPIRATION
      });
    }

    /**
     * Authenticate users
     * @static
     * @returns {function} Returns an expresss middleware function that handles user authentication
     * @memberof UserController
     */

  }, {
    key: 'authenticateUser',
    value: function authenticateUser() {
      var _this4 = this;

      cov_20rryxkpmw.f[5]++;
      cov_20rryxkpmw.s[25]++;

      return function (req, res, next) {
        cov_20rryxkpmw.f[6]++;

        var message = (cov_20rryxkpmw.s[26]++, 'Access denied! Token not provided');
        var token = (cov_20rryxkpmw.s[27]++, (cov_20rryxkpmw.b[5][0]++, req.cookies.token) || (cov_20rryxkpmw.b[5][1]++, req.getAuthorization) || (cov_20rryxkpmw.b[5][2]++, req.query.token) || (cov_20rryxkpmw.b[5][3]++, req.body.token) || (cov_20rryxkpmw.b[5][4]++, req.headers.token));
        cov_20rryxkpmw.s[28]++;
        if (token) {
          cov_20rryxkpmw.b[6][0]++;

          var regex = (cov_20rryxkpmw.s[29]++, new RegExp('/^Bearer (\S+)$/'));
          var match = (cov_20rryxkpmw.s[30]++, regex.exec(token));

          cov_20rryxkpmw.s[31]++;
          token = match ? (cov_20rryxkpmw.b[7][0]++, match[1]) : (cov_20rryxkpmw.b[7][1]++, token);
          var decoded = void 0;
          cov_20rryxkpmw.s[32]++;
          try {
            cov_20rryxkpmw.s[33]++;

            decoded = _jsonwebtoken2.default.verify(token, process.env.SECRET_KEY, {
              issuer: process.env.ISSUER
            });
            cov_20rryxkpmw.s[34]++;
            if (decoded) {
              cov_20rryxkpmw.b[8][0]++;

              var length = (cov_20rryxkpmw.s[35]++, _collections2.default.getUsersCount());
              cov_20rryxkpmw.s[36]++;
              for (var i = 0; i < length; i++) {
                cov_20rryxkpmw.s[37]++;

                if (parseInt(_collections2.default.getUsers()[i].userId, 10) === parseInt(decoded.userId, 10)) {
                  cov_20rryxkpmw.b[9][0]++;
                  cov_20rryxkpmw.s[38]++;

                  req.body.decoded = decoded;
                  cov_20rryxkpmw.s[39]++;
                  return next();
                } else {
                  cov_20rryxkpmw.b[9][1]++;
                }
              }
              cov_20rryxkpmw.s[40]++;
              message = 'Sorry, user does not exist';
            } else {
              cov_20rryxkpmw.b[8][1]++;
            }
          } catch (error) {
            cov_20rryxkpmw.s[41]++;

            if (error.message === 'jwt expired') {
              cov_20rryxkpmw.b[10][0]++;
              cov_20rryxkpmw.s[42]++;

              message = 'Access denied! Token has expired';
            } else {
              cov_20rryxkpmw.b[10][1]++;
              cov_20rryxkpmw.s[43]++;

              message = 'Access denied! Invalid authentication token';
            }
          }
        } else {
          cov_20rryxkpmw.b[6][1]++;
        }
        cov_20rryxkpmw.s[44]++;
        return _this4.errorResponse(res, 401, message);
      };
    }

    /**
     * Authorize a user
     * @static
     * @returns {function} Returns an express middleware that handles the authorization
     * @memberof UserController
     */

  }, {
    key: 'authorizeUser',
    value: function authorizeUser() {
      var _this5 = this;

      cov_20rryxkpmw.f[7]++;
      cov_20rryxkpmw.s[45]++;

      return function (req, res, next) {
        cov_20rryxkpmw.f[8]++;
        cov_20rryxkpmw.s[46]++;

        return req.body.decoded.isAdmin ? (cov_20rryxkpmw.b[11][0]++, next()) : (cov_20rryxkpmw.b[11][1]++, _this5.errorResponse(res, 401, 'You do not have the privilege for this operation'));
      };
    }
  }]);

  return UserController;
}(_UtilityService3.default);

exports.default = UserController;